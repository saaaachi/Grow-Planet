<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grow Planet - ç¬¬40å¼¾</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1a237e; font-family: sans-serif; touch-action: none; position: fixed; width: 100%; height: 100%; }
        
        /* åºƒå‘Šæ ï¼š100px */
        #ad-top, #ad-bottom { position: fixed; left: 0; width: 100%; height: 100px; background: #333; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #ad-top { top: 0; } #ad-bottom { bottom: 0; }
        iframe { border: none; width: 100%; height: 100px; }

        /* ã‚²ãƒ¼ãƒ æœ¬ä½“ã‚¨ãƒªã‚¢ */
        #game-outer { position: absolute; top: 100px; bottom: 100px; left: 0; right: 0; background: #1a237e; overflow: hidden; display: flex; flex-direction: column; }
        
        #game-area { flex-grow: 1; position: relative; width: 100%; height: 100%; overflow: hidden; }
        #game-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 50%, #283593, #1a237e 70%); }

        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; padding: 10px; display: flex; justify-content: space-around; z-index: 10; }
        .ui-box { padding: 5px 15px; border-radius: 15px; font-weight: bold; color: white; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); font-size: 16px; }

        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        #menuScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; z-index: 50; 
            padding: 20px 0; overflow-y: auto; color: white; -webkit-overflow-scrolling: touch;
        }
        #result-msg { color: #8bc34a; margin: 15px 0; font-size: 28px; text-align: center; }
        .guide-text { padding: 0 20px; text-align: center; font-size: 14px; margin-bottom: 15px; color: #cfd8dc; }

        #ad-middle-container { width: 300px; height: 120px; background: #000; margin: 15px 0; display: none; justify-content: center; align-items: center; }

        .menu-btn-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 12px; padding-bottom: 40px; }
        .menu-btn { width: 260px; padding: 15px; font-size: 18px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; white-space: nowrap; }
        #retry-btn { background: #8bc34a; color: #000; box-shadow: 0 4px #558b2f; }
        #more-games-btn { background: #ff4081; color: white; box-shadow: 0 4px #c2185b; }
    </style>
</head>
<body>

    <div id="ad-top"><iframe id="frame-top" src="ad.html"></iframe></div>

    <div id="game-outer">
        <div id="game-area" onmousedown="grow()" ontouchstart="grow()">
            <canvas id="game-canvas"></canvas>
            <div id="ui-layer">
                <div id="score-display" class="ui-box">SCORE: 0</div>
                <div id="health-display" class="ui-box">HP: 3</div>
            </div>
        </div>

        <div id="menuScreen">
            <h2 id="result-msg">Grow Planet</h2>
            <p class="guide-text">ã‚¿ãƒƒãƒ—ã§æƒ‘æ˜Ÿã‚’å¤§ããã—ã¦ã‚¹ã‚³ã‚¢ã‚’ç¨¼ã”ã†ï¼<br>è¿«ã‚Šãã‚‹éš•çŸ³ã«å½“ãŸã‚‹ã¨HPãŒæ¸›ã‚‹ãã€‚<br>HPãŒãªããªã£ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼</p>
            
            <div id="ad-middle-container">
                <script src="https://adm.shinobi.jp/s/1e6de436ea850948e238e975a93767eb"></script>
            </div>

            <div class="menu-btn-group">
                <button id="retry-btn" class="menu-btn" onclick="startNewGame()">â˜… ã‚¹ã‚¿ãƒ¼ãƒˆ â˜…</button>
                <a href="https://saaaachi.github.io/10-Stack/" id="more-games-btn" class="menu-btn">â˜… ä»–ã®ã‚²ãƒ¼ãƒ ã¯ã“ã¡ã‚‰ â˜…</a>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe id="frame-bottom" src="ad.html"></iframe></div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        let planet = { x: 0, y: 0, radius: 20, growthRate: 0.8, decayRate: 0.08, color: '#8bc34a' };
        let asteroids = [];
        let score = 0, health = 3;
        let gameActive = false;
        let animationFrameId;

        const menuScreen = document.getElementById("menuScreen");
        const adMid = document.getElementById("ad-middle-container");
        const resultMsg = document.getElementById("result-msg");
        const retryBtn = document.getElementById("retry-btn");

        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            planet.x = canvas.width / 2;
            planet.y = canvas.height / 2;
            draw();
        }

        function startNewGame() {
            menuScreen.style.display = "none";
            adMid.style.display = "none";
            score = 0;
            health = 3;
            planet.radius = 20;
            asteroids = [];
            gameActive = true;
            updateUI();
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            gameLoop();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // æƒ‘æ˜Ÿã‚’æç”»
            ctx.beginPath();
            ctx.arc(planet.x, planet.y, planet.radius, 0, Math.PI * 2);
            ctx.fillStyle = planet.color;
            ctx.shadowColor = 'rgba(139, 195, 74, 0.5)';
            ctx.shadowBlur = 20;
            ctx.fill();
            ctx.closePath();
            ctx.shadowBlur = 0; // ã‚·ãƒ£ãƒ‰ã‚¦ã‚’ãƒªã‚»ãƒƒãƒˆ

            // éš•çŸ³ã‚’æç”»
            asteroids.forEach(a => {
                ctx.beginPath();
                ctx.arc(a.x, a.y, a.radius, 0, Math.PI * 2);
                ctx.fillStyle = a.color;
                ctx.fill();
                ctx.closePath();
            });
        }

        function update() {
            if (!gameActive) return;

            // æƒ‘æ˜Ÿã®ç¸®å°
            planet.radius = Math.max(20, planet.radius - planet.decayRate);
            score = Math.floor(planet.radius - 20); // åŸºæº–ã‚µã‚¤ã‚ºã‚ˆã‚Šå¤§ãã„åˆ†ã‚’ã‚¹ã‚³ã‚¢ã«

            // éš•çŸ³ã®ç”Ÿæˆ
            if (Math.random() < 0.02 * (1 + score / 100)) { // ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦éš•çŸ³ã®é »åº¦å¢—åŠ 
                const side = Math.floor(Math.random() * 4); // 0:top, 1:right, 2:bottom, 3:left
                let x, y, dx, dy;
                const asteroidRadius = Math.random() * 8 + 4; // éš•çŸ³ã®ã‚µã‚¤ã‚º
                const speed = Math.random() * 2 + 1 + (score / 200); // éš•çŸ³ã®é€Ÿåº¦ã‚‚ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦å¢—åŠ 

                switch (side) {
                    case 0: // Top
                        x = Math.random() * canvas.width;
                        y = -asteroidRadius;
                        dx = (planet.x - x + (Math.random() - 0.5) * 100) / canvas.height * speed;
                        dy = speed;
                        break;
                    case 1: // Right
                        x = canvas.width + asteroidRadius;
                        y = Math.random() * canvas.height;
                        dx = -speed;
                        dy = (planet.y - y + (Math.random() - 0.5) * 100) / canvas.width * speed;
                        break;
                    case 2: // Bottom
                        x = Math.random() * canvas.width;
                        y = canvas.height + asteroidRadius;
                        dx = (planet.x - x + (Math.random() - 0.5) * 100) / canvas.height * speed;
                        dy = -speed;
                        break;
                    case 3: // Left
                        x = -asteroidRadius;
                        y = Math.random() * canvas.height;
                        dx = speed;
                        dy = (planet.y - y + (Math.random() - 0.5) * 100) / canvas.width * speed;
                        break;
                }
                asteroids.push({ x, y, radius: asteroidRadius, dx, dy, color: '#78909c' });
            }

            // éš•çŸ³ã®ç§»å‹•ã¨è¡çªåˆ¤å®š
            asteroids = asteroids.filter(a => {
                a.x += a.dx;
                a.y += a.dy;

                // æƒ‘æ˜Ÿã¨ã®è¡çªåˆ¤å®š
                const distance = Math.sqrt(Math.pow(planet.x - a.x, 2) + Math.pow(planet.y - a.y, 2));
                if (distance < planet.radius + a.radius) {
                    health--;
                    updateUI();
                    if (health <= 0) {
                        gameOver("æƒ‘æ˜Ÿå´©å£Šï¼ğŸ˜±");
                        return false;
                    }
                    return false; // è¡çªã—ãŸéš•çŸ³ã¯æ¶ˆãˆã‚‹
                }

                // ç”»é¢å¤–ã«å‡ºãŸéš•çŸ³ã¯æ¶ˆã™
                return a.x > -a.radius && a.x < canvas.width + a.radius &&
                       a.y > -a.radius && a.y < canvas.height + a.radius;
            });
            updateUI();
        }

        function grow() {
            if (!gameActive) return;
            planet.radius += planet.growthRate;
            planet.radius = Math.min(canvas.height / 2 - 10, planet.radius); // ç”»é¢ã®åŠåˆ†ãã‚‰ã„ãŒæœ€å¤§
        }

        function gameLoop() {
            update();
            draw();
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        function updateUI() {
            document.getElementById("score-display").innerText = "SCORE: " + score;
            document.getElementById("health-display").innerText = "HP: " + health;
        }

        function gameOver(msg) {
            gameActive = false;
            cancelAnimationFrame(animationFrameId);
            resultMsg.innerText = msg + "\næœ€çµ‚ã‚¹ã‚³ã‚¢: " + score;
            retryBtn.innerText = "â˜… ã‚‚ã†ä¸€åº¦éŠã¶ â˜…";
            adMid.style.display = "flex";
            menuScreen.style.display = "flex";
            menuScreen.scrollTop = 0;
        }

        function refreshAds() {
            const t = document.getElementById('frame-top');
            const b = document.getElementById('frame-bottom');
            if(t) t.src = t.src;
            if(b) b.src = b.src;
        }
        setInterval(refreshAds, 30000);

        window.addEventListener('resize', resizeCanvas);
        window.onload = () => { 
            resizeCanvas();
            document.getElementById("menuScreen").style.display = "flex"; 
        };
    </script>
</body>
</html>
